<!DOCTYPE html>
<html>
<head>
  <meta name="databricks-html-version" content="1">
<title>RDDs, DataFrames and Datasets - Databricks</title>

<meta charset="utf-8">
<meta name="google" content="notranslate">
<meta http-equiv="Content-Language" content="en">
<meta http-equiv="Content-Type" content="text/html; charset=UTF8">
<link rel="stylesheet"
  href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700">

<link rel="stylesheet" type="text/css" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/201603010716030000-6118bb36ced9f46ebd6354723c21ab530ae8e014/lib/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/201603010716030000-6118bb36ced9f46ebd6354723c21ab530ae8e014/lib/jquery-ui-bundle/jquery-ui.min.css">
<link rel="stylesheet" type="text/css" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/201603010716030000-6118bb36ced9f46ebd6354723c21ab530ae8e014/css/main.css">
<link rel="stylesheet" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/201603010716030000-6118bb36ced9f46ebd6354723c21ab530ae8e014/css/print.css" media="print">
<link rel="icon" type="image/png" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/201603010716030000-6118bb36ced9f46ebd6354723c21ab530ae8e014/img/favicon.ico"/>
<script>window.settings = {"devTierName":"Community Edition","workspaceFeaturedLinks":[{"linkURI":"https://docs.cloud.databricks.com/docs/latest/databricks_guide/index.html","displayName":"Databricks Guide","icon":"question"},{"linkURI":"https://docs.cloud.databricks.com/docs/latest/sample_applications/index.html","displayName":"Application Examples","icon":"code"},{"linkURI":"https://docs.cloud.databricks.com/docs/latest/courses/index.html","displayName":"Training","icon":"graduation-cap"}],"sparkDocsSearchGoogleCx":"004588677886978090460:_rj0wilqwdm","dbcForumURL":"http://forums.databricks.com/","dbfsS3Host":"https://databricks-prod-storage-oregon.s3.amazonaws.com","nodeInfo":{"node_types":[{"spark_heap_memory":23800,"instance_type_id":"r3.2xlarge","node_type_id":"memory-optimized","description":"Memory Optimized","container_memory_mb":28000,"memory_mb":30720,"num_cores":4.0},{"spark_heap_memory":9702,"instance_type_id":"c3.4xlarge","node_type_id":"compute-optimized","description":"Compute Optimized","container_memory_mb":12128,"memory_mb":15360,"num_cores":8.0}],"default_node_type_id":"memory-optimized"},"enableThirdPartyApplicationsUI":false,"enableClusterAcls":false,"notebookRevisionVisibilityHorizon":0,"enableTableHandler":true,"isAdmin":true,"enableLargeResultDownload":true,"zoneInfos":[{"id":"us-west-2a","isDefault":true},{"id":"us-west-2c","isDefault":false},{"id":"us-west-2b","isDefault":false}],"nameAndEmail":"Brian Clapper (bmc@ardentex.com)","enablePublishNotebooks":false,"enableFullTextSearch":true,"enableElasticSparkUI":true,"clusters":true,"allowRunOnPendingClusters":true,"hideOffHeapCache":false,"applications":false,"useStaticGuide":false,"fileStoreBase":"FileStore","configurableSparkOptionsSpec":[{"keyPattern":"spark\\.kryo(\\.[^\\.]+)+","valuePattern":".*","keyPatternDisplay":"spark.kryo.*","valuePatternDisplay":"*","description":"Configuration options for Kryo serialization"},{"keyPattern":"spark\\.io\\.compression\\.codec","valuePattern":"(lzf|snappy|org\\.apache\\.spark\\.io\\.LZFCompressionCodec|org\\.apache\\.spark\\.io\\.SnappyCompressionCodec)","keyPatternDisplay":"spark.io.compression.codec","valuePatternDisplay":"snappy|lzf","description":"The codec used to compress internal data such as RDD partitions, broadcast variables and shuffle outputs."},{"keyPattern":"spark\\.serializer","valuePattern":"(org\\.apache\\.spark\\.serializer\\.JavaSerializer|org\\.apache\\.spark\\.serializer\\.KryoSerializer)","keyPatternDisplay":"spark.serializer","valuePatternDisplay":"org.apache.spark.serializer.JavaSerializer|org.apache.spark.serializer.KryoSerializer","description":"Class to use for serializing objects that will be sent over the network or need to be cached in serialized form."},{"keyPattern":"spark\\.rdd\\.compress","valuePattern":"(true|false)","keyPatternDisplay":"spark.rdd.compress","valuePatternDisplay":"true|false","description":"Whether to compress serialized RDD partitions (e.g. for StorageLevel.MEMORY_ONLY_SER). Can save substantial space at the cost of some extra CPU time."},{"keyPattern":"spark\\.speculation","valuePattern":"(true|false)","keyPatternDisplay":"spark.speculation","valuePatternDisplay":"true|false","description":"Whether to use speculation (recommended off for streaming)"},{"keyPattern":"spark\\.es(\\.[^\\.]+)+","valuePattern":".*","keyPatternDisplay":"spark.es.*","valuePatternDisplay":"*","description":"Configuration options for ElasticSearch"},{"keyPattern":"es(\\.([^\\.]+))+","valuePattern":".*","keyPatternDisplay":"es.*","valuePatternDisplay":"*","description":"Configuration options for ElasticSearch"},{"keyPattern":"spark\\.(storage|shuffle)\\.memoryFraction","valuePattern":"0?\\.0*([1-9])([0-9])*","keyPatternDisplay":"spark.(storage|shuffle).memoryFraction","valuePatternDisplay":"(0.0,1.0)","description":"Fraction of Java heap to use for Spark's shuffle or storage"},{"keyPattern":"spark\\.streaming\\.backpressure\\.enabled","valuePattern":"(true|false)","keyPatternDisplay":"spark.streaming.backpressure.enabled","valuePatternDisplay":"true|false","description":"Enables or disables Spark Streaming's internal backpressure mechanism (since 1.5). This enables the Spark Streaming to control the receiving rate based on the current batch scheduling delays and processing times so that the system receives only as fast as the system can process. Internally, this dynamically sets the maximum receiving rate of receivers. This rate is upper bounded by the values `spark.streaming.receiver.maxRate` and `spark.streaming.kafka.maxRatePerPartition` if they are set."},{"keyPattern":"spark\\.streaming\\.receiver\\.maxRate","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.receiver.maxRate","valuePatternDisplay":"numeric","description":"Maximum rate (number of records per second) at which each receiver will receive data. Effectively, each stream will consume at most this number of records per second. Setting this configuration to 0 or a negative number will put no limit on the rate. See the deployment guide in the Spark Streaming programing guide for mode details."},{"keyPattern":"spark\\.streaming\\.kafka\\.maxRatePerPartition","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.kafka.maxRatePerPartition","valuePatternDisplay":"numeric","description":"Maximum rate (number of records per second) at which data will be read from each Kafka partition when using the Kafka direct stream API introduced in Spark 1.3. See the Kafka Integration guide for more details."},{"keyPattern":"spark\\.streaming\\.kafka\\.maxRetries","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.kafka.maxRetries","valuePatternDisplay":"numeric","description":"Maximum number of consecutive retries the driver will make in order to find the latest offsets on the leader of each partition (a default value of 1 means that the driver will make a maximum of 2 attempts). Only applies to the Kafka direct stream API introduced in Spark 1.3."},{"keyPattern":"spark\\.streaming\\.ui\\.retainedBatches","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.ui.retainedBatches","valuePatternDisplay":"numeric","description":"How many batches the Spark Streaming UI and status APIs remember before garbage collecting."},{"keyPattern":"spark\\.sql\\.parquet.cacheMetadata","valuePattern":"(true|false)","keyPatternDisplay":"spark.sql.parquet.cacheMetadata","valuePatternDisplay":"true|false","description":"Whether to cache parquet metadata"},{"keyPattern":"spark\\.serializer","valuePattern":".*","keyPatternDisplay":"spark.serializer","valuePatternDisplay":"org.apache.spark.serializer.JavaSerializer|org.apache.spark.serializer.KryoSerializer","description":"allowed serializers"}],"enableReactNotebookComments":true,"enableResetPassword":true,"enableJobsSparkUpgrade":true,"sparkVersions":[{"key":"1.3.x-ubuntu15.10","displayName":"Spark 1.3.0","packageLabel":"spark-1.3-jenkins-ip-10-30-10-144-U6118bb36ce-Sa2ee4664b2-2016-03-01-17:03:30.410441","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.4.x-ubuntu15.10","displayName":"Spark 1.4.1","packageLabel":"spark-1.4-jenkins-ip-10-30-10-144-U6118bb36ce-S9c254ab12a-2016-03-01-17:03:30.410441","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.5.x-ubuntu15.10","displayName":"Spark 1.5.2","packageLabel":"spark-1.5-jenkins-ip-10-30-10-144-U6118bb36ce-S9ca52d000d-2016-03-01-17:03:30.410441","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.x-ubuntu15.10","displayName":"Spark 1.6.0","packageLabel":"spark-1.6-jenkins-ip-10-30-10-144-U6118bb36ce-Sf90f83597b-2016-03-01-17:03:30.410441","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"master","displayName":"Spark master (dev)","packageLabel":"","upgradable":true,"deprecated":false,"customerVisible":false}],"enableRestrictedClusterCreation":false,"enableFeedback":false,"defaultNumWorkers":8,"defaultZoneId":"us-west-2a","serverContinuationTimeoutMillis":10000,"driverStderrFilePrefix":"stderr","driverStdoutFilePrefix":"stdout","enableSparkDocsSearch":true,"prefetchSidebarNodes":true,"sparkHistoryServerEnabled":true,"sanitizeMarkdownHtml":true,"enableIPythonImportExport":true,"enableNotebookHistoryDiffing":true,"branch":"2.14","accountsLimit":-1,"enableNotebookGitBranching":true,"local":false,"displayDefaultContainerMemoryGB":30,"devTierHomepageDesign":"control","deploymentMode":"production","useSpotForWorkers":false,"enableUserInviteWorkflow":false,"enableStaticNotebooks":true,"dbcGuideURL":"#workspace/databricks_guide/00 Welcome to Databricks","enableCssTransitions":true,"showHomepageFeaturedLinks":false,"pricingURL":"https://databricks.com/product/pricing","enableClusterAclsConfig":false,"orgId":0,"enableNotebookGitVersioning":true,"files":"files/","enableDriverLogsUI":true,"disableLegacyDashboards":false,"enableWorkspaceAclsConfig":true,"dropzoneMaxFileSize":4096,"enableNewDashboardViews":true,"driverLog4jFilePrefix":"log4j","enableMavenLibraries":true,"displayRowLimit":1000,"defaultSparkVersion":{"key":"1.5.x-ubuntu15.10","displayName":"Spark 1.5.2","packageLabel":"spark-1.5-jenkins-ip-10-30-10-144-U6118bb36ce-S9ca52d000d-2016-03-01-17:03:30.410441","upgradable":true,"deprecated":false,"customerVisible":true},"enableMountAclsConfig":false,"clusterPublisherRootId":5,"enableLatestJobRunResultPermalink":true,"disallowAddingAdmins":false,"enableSparkConfUI":true,"enableOrgSwitcherUI":false,"clustersLimit":-1,"enableJdbcImport":true,"logfiles":"logfiles/","enableWebappSharding":false,"enableClusterDeltaUpdates":true,"csrfToken":"03c7f4a2-690e-4dda-8670-01ec2e1c073f","useFixedStaticNotebookVersionForDevelopment":false,"enableMountAcls":false,"requireEmailUserName":true,"enableDashboardViews":false,"dbcFeedbackURL":"http://feedback.databricks.com/forums/263785-product-feedback","enableMountAclService":true,"enableWorkspaceAclService":true,"someName":"Brian Clapper","enableWorkspaceAcls":true,"gitHash":"6118bb36ced9f46ebd6354723c21ab530ae8e014","showWorkspaceFeaturedLinks":false,"userFullname":"Brian Clapper","allowFeedbackForumAccess":true,"enableClusterCreatePage":true,"enableImportFromUrl":true,"enableMiniClusters":false,"enableWebSocketDeltaUpdates":true,"showDevTierBetaVersion":false,"enableDebugUI":false,"showHiddenSparkVersions":false,"allowNonAdminUsers":true,"userId":100006,"dbcSupportURL":"http://help.databricks.com","staticNotebookResourceUrl":"https://databricks-prod-cloudfront.cloud.databricks.com/static/201603010716030000-6118bb36ced9f46ebd6354723c21ab530ae8e014/","enableSparkPackages":true,"enableHybridClusterType":true,"enableNotebookHistoryUI":true,"availableWorkspaces":[{"name":"Workspace 0","orgId":0}],"enableFolderHtmlExport":true,"enableSparkVersionsUI":true,"homepageFeaturedLinks":[{"linkURI":"https://docs.cloud.databricks.com/docs/latest/featured_notebooks/1%20QuickStart%20Notebooks%20(Python).html","displayName":"Getting Started","icon":"img/home/Python_icon.svg"},{"linkURI":"https://docs.cloud.databricks.com/docs/latest/featured_notebooks/3%20QuickStart%20DataFrames%20(Scala).html","displayName":"Introduction to DataFrames","icon":"img/home/Scala_icon.svg"},{"linkURI":"https://docs.cloud.databricks.com/docs/latest/featured_notebooks/DecisionTrees-Example.html","displayName":"Decision Trees in Spark","icon":"img/home/Scala_icon.svg"}],"databricksGuideStaticUrl":"","enableHybridClusters":true,"upgradeURL":"","clusterManagerAclsEnabled":false,"notebookLoadingBackground":"#fff","enableNewJobRunDetailsPage":true,"user":"bmc@ardentex.com","enableServerAutoComplete":true,"enableStaticHtmlImport":true,"defaultMemoryPerContainerMB":28000,"enablePresenceUI":true,"tablesPublisherRootId":7,"enableNewInputWidgetUI":false,"accounts":true,"useFramedStaticNotebooks":true,"enableNewProgressReportUI":true,"defaultCoresPerContainer":4};</script>
<script>var __DATABRICKS_NOTEBOOK_MODEL = {"version":"NotebookV1","origId":398768,"name":"RDDs, DataFrames and Datasets","language":"scala","commands":[{"version":"CommandV1","origId":398770,"guid":"15712196-ce85-46c3-a07e-f211affa5ac1","subtype":"command","commandType":"auto","position":2.0,"command":"%md\n\n#![Wikipedia Logo](http://sameerf-dbc-labs.s3-website-us-west-2.amazonaws.com/data/wikipedia/images/w_logo_for_labs.png)\n\n# RDDs, DataFrames and Datasets\n\n## Using Wikipedia data\n\nWe're going to use some Wikipedia data, representing changes to various Wikimedia project pages in an hour's time. These edits are from March 3rd (yesterday), covering the hour starting at 22:00 UTC.\n\nDataset: https://dumps.wikimedia.org/other/pagecounts-raw/","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"3ecf9add-68c4-4f02-8fad-c2c4af30cba4"},{"version":"CommandV1","origId":398771,"guid":"ca723ba0-faf0-4b45-9565-587464937dc4","subtype":"command","commandType":"auto","position":3.0,"command":"%fs ls dbfs:/mnt/training-write/essentials/pagecounts/staging/","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":1.457062059164E12,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"bmc@ardentex.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"406b79be-11b2-4630-ad53-efe63bbb31cf"},{"version":"CommandV1","origId":398772,"guid":"36c5aea5-064d-40a3-b43b-d5fb14e5d27b","subtype":"command","commandType":"auto","position":4.0,"command":"%md How big is the file, in megabytes?","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"d0f8fb61-02b8-4f29-875e-61cbce555c02"},{"version":"CommandV1","origId":398773,"guid":"f4097e3f-aced-4087-8cd2-3b51bcb54ddc","subtype":"command","commandType":"auto","position":5.0,"command":"dbutils.fs.ls(\"dbfs:/mnt/training-write/essentials/pagecounts/staging/\").map(_.size).head / (1024 * 1024)","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":1.457062059988E12,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"bmc@ardentex.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"f9678215-95e3-476c-b895-dd47e8e652c5"},{"version":"CommandV1","origId":398774,"guid":"906ff219-bc4a-49e4-a5b1-71416d66b529","subtype":"command","commandType":"auto","position":6.0,"command":"%md\n### RDDs\nRDDs can be created by using the Spark Context object's `textFile()` method.","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"43df6153-030f-4fb2-bacf-98b9eabb071e"},{"version":"CommandV1","origId":398775,"guid":"6ebb86f4-4279-4e11-b082-9e6aced70ee2","subtype":"command","commandType":"auto","position":7.0,"command":"%md Create an RDD from the recent pagecounts file:","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"2c4409c9-8af6-4d3f-8de6-c6af8249cd41"},{"version":"CommandV1","origId":398776,"guid":"8542b9c3-ddac-4925-95a5-548f8b0d3cf9","subtype":"command","commandType":"auto","position":8.0,"command":"// Notice that this returns a RDD of Strings\nval pagecountsRDD = sc.textFile(\"dbfs:/mnt/training-write/essentials/pagecounts/staging/pagecounts-20160303-220000.gz\")","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":1.457062062389E12,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"bmc@ardentex.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"f2db29f2-279b-44fd-8c3b-0df9bdfc48d4"},{"version":"CommandV1","origId":398777,"guid":"d1d6a3c3-0f5e-4461-8f73-6c1c24476ab2","subtype":"command","commandType":"auto","position":9.0,"command":"%md There's one partition, because a gzipped file cannot be uncompressed in parallel.","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"049f9b4f-cdf4-43ae-a7f0-d3a85b1ffb59"},{"version":"CommandV1","origId":398778,"guid":"0c5faae9-cfbf-473a-9661-5cccb8af19ab","subtype":"command","commandType":"auto","position":10.0,"command":"pagecountsRDD.partitions.length","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":1.45706206457E12,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"bmc@ardentex.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"c925b15a-8b01-482c-9fa9-5068306e14c5"},{"version":"CommandV1","origId":398779,"guid":"63c1b286-2c79-47ea-b3f9-ae5be6cd7644","subtype":"command","commandType":"auto","position":11.0,"command":"%md Let's increase the parallelism by repartitioning.","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"a9a3b648-21b7-4196-98ce-7cc542763b36"},{"version":"CommandV1","origId":398780,"guid":"78f206b7-fd48-43d1-9c83-3ccafd8e9d02","subtype":"command","commandType":"auto","position":12.0,"command":"val pagecountsRDD2 = pagecountsRDD.repartition(16)\npagecountsRDD2.partitions.length","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":1.457062066762E12,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"bmc@ardentex.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"1da8ddfc-718f-4fc2-8e61-3be1a4596c0f"},{"version":"CommandV1","origId":398781,"guid":"53a98f2d-b14e-4905-a2f0-2c961cbfbe74","subtype":"command","commandType":"auto","position":13.0,"command":"%md The `count` action counts how many items (lines) total are in the RDD (this requires a full scan of the file):","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"73fa8b54-bc5f-42e2-881c-c8ca21de79e0"},{"version":"CommandV1","origId":398782,"guid":"3142d100-5f07-4934-93ce-af9d72ffc370","subtype":"command","commandType":"auto","position":14.0,"command":"pagecountsRDD2.count()","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":1.457062068699E12,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"bmc@ardentex.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"eaec66f7-78c2-46b1-acc3-aa4c4da40587"},{"version":"CommandV1","origId":398783,"guid":"b2129ba1-70a7-4620-80a6-212405efc3da","subtype":"command","commandType":"auto","position":15.0,"command":"%md So the count shows that there are aalmost 7.5 million lines in the file. Notice that the `count()` action took 15 - 25 seconds to run because it had to read the entire file remotely from S3.","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"f4c7f843-3e41-4ef2-b72b-db5c3b3e0e62"},{"version":"CommandV1","origId":398784,"guid":"7b9b525b-c8c2-4d02-94d2-3bd946c31360","subtype":"command","commandType":"auto","position":16.0,"command":"%md Let's take a look at some of the data. This will return faster, because `take()` doesn't have to process the whole file.","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"06e6de8a-120e-434b-b5e2-bcb5abcb6df6"},{"version":"CommandV1","origId":398785,"guid":"30c53190-2244-49a7-917e-aea8bceac1a1","subtype":"command","commandType":"auto","position":17.0,"command":"pagecountsRDD2.take(10).foreach(println)","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":1.457062072087E12,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"bmc@ardentex.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"f90d69da-37e1-4c55-b782-83ffc5a8f1f2"},{"version":"CommandV1","origId":398786,"guid":"8cd2d2cc-4a6f-4b18-a0a8-950570fde933","subtype":"command","commandType":"auto","position":18.0,"command":"%md Notice that each line in the file actually contains 2 strings and 2 numbers, but our RDD is treating each line as a long string. We'll fix this typing issue shortly by using a custom parsing function.","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"d58e4182-f1ff-427d-b0f3-aa1f06df2fc2"},{"version":"CommandV1","origId":398787,"guid":"0a641b38-efd2-4568-8d5d-6636334064b7","subtype":"command","commandType":"auto","position":19.0,"command":"%md In the output above, the first column (like `aa`) is the Wikimedia project name. The following abbreviations are used for the first column:\n\n* wikibooks: `\".b\"`\n* wiktionary: `\".d\"`\n* wikimedia: `\".m\"`\n* wikipedia mobile: `\".mw\"`\n* wikinews: `\".n\"`\n* wikiquote: `\".q\"`\n* wikisource: `\".s\"`\n* wikiversity: `\".v\"`\n* mediawiki: `\".w\"`\n\nProjects without a period and a following character are Wikipedia projects. So, any line starting with the column `aa` refers to the Aragones language Wikipedia. Similarly, any line starting with the column `en` refers to the English language Wikipedia. `en.b` refers to English Language Wikibooks.\n\nThe second column is the title of the page retrieved, the third column is the number of requests, and the fourth column is the size of the content returned.","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"a6826e52-56b8-432f-94d1-da3e4662960e"},{"version":"CommandV1","origId":398788,"guid":"f63cfc2b-59f1-4e8d-b8d0-80e5b20baba9","subtype":"command","commandType":"auto","position":20.0,"command":"%md Let's cache the RDD, so we're not reading the gzipped file over and over again.","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"fa4b9a9e-bc81-487d-82fe-c3dcc95333ec"},{"version":"CommandV1","origId":398789,"guid":"db52efc1-8d8c-4303-ab17-6fdcfce20354","subtype":"command","commandType":"auto","position":21.0,"command":"pagecountsRDD2.setName(\"pagecountsRDD2\").cache().count() // we need to run an action to fill the cache","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":1.457062075442E12,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"bmc@ardentex.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"8620c5f0-44aa-4b6c-a1f5-7ea89aa594de"},{"version":"CommandV1","origId":398790,"guid":"8993ea28-ca18-49ac-9eb6-2a1e5a76e5a5","subtype":"command","commandType":"auto","position":22.0,"command":"%md Let's sum up the request counts per page in the English Wikipiedia, then pull back the top 10. This is a variation of the code on Slide 5.\n  ","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"310e41ac-4963-48dd-bc02-e6a5a946c927"},{"version":"CommandV1","origId":398791,"guid":"65eeb4ce-8a2b-4d7d-ad83-8a5ceedb4581","subtype":"command","commandType":"auto","position":23.0,"command":"pagecountsRDD2.flatMap { line =>\n  line.split(\"\"\"\\s+\"\"\") match {\n    case Array(project, page, numRequests, contentSize) => Some((project, page, numRequests.toLong))\n    case _ => None\n  }\n}.\nfilter { case (project, page, numRequests) => project == \"en\" }.\nmap { case (project, page, numRequests) => (page, numRequests) }.\nreduceByKey(_ + _).\nsortBy({ case (page, numRequests) => numRequests }, ascending = false).\ntake(100).\nforeach { case (page, totalRequests) => println(s\"$page: $totalRequests\") }","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":1.45706207661E12,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"bmc@ardentex.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"37db82ab-9ebf-4708-bf2e-1c63e0f1cd28"},{"version":"CommandV1","origId":398792,"guid":"47ba02c2-f0cd-4b38-9d08-3ebdc9528854","subtype":"command","commandType":"auto","position":24.0,"command":"%md Let's remove the special pages. Page like \"Talk:Topic\", \"User:username\", \"Special:Something\", and anything starting with a \".\" are just cluttering things up. Here's a modification of the above, with\na slightly modified `filter()` call.","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"476bf269-364b-4eb2-9ff2-085da8478e28"},{"version":"CommandV1","origId":398793,"guid":"a875c24c-f64b-41a7-98d3-3a95b0e6c170","subtype":"command","commandType":"auto","position":25.0,"command":"pagecountsRDD2.flatMap { line =>\n  line.split(\"\"\"\\s+\"\"\") match {\n    case Array(project, page, numRequests, contentSize) => Some((project, page, numRequests.toLong))\n    case _ => None\n  }\n}.\nfilter { case (project, page, numRequests) => \n  (project == \"en\") && (! page.contains(\":\")) && (! page.startsWith(\".\"))\n}.\nmap { case (project, page, numRequests) => (page, numRequests) }.\nreduceByKey(_ + _).\nsortBy({ case (page, numRequests) => numRequests }, ascending = false).\ntake(100).\nforeach { case (page, totalRequests) => println(s\"$page: $totalRequests\") }","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":1.457062078419E12,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"bmc@ardentex.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"e9191a93-dd16-43f3-ad48-51a542cfaa9b"},{"version":"CommandV1","origId":398794,"guid":"13b8e238-f312-4901-b351-2871ee496496","subtype":"command","commandType":"auto","position":26.0,"command":"%md That's completely type-safe, but it's up to us to choose the right implementation. For instance, the code, above, _could_ have by done like this:\n\n```\npagecountsParsedRDD2.flatMap { ... }.\n                     filter { ... }.\n                     map { case (project, page, numRequests) => (page, numRequests) }.\n                     groupByKey(_._1).\n                     reduce(_ + _).\n                     ...\n```\n\nHowever, `groupByKey() + reduce()` is _far_ more inefficient than `reduceByKey()`. Yet, Spark cannot protect us from choosing the wrong transformations.","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"a543f5f4-ca03-40e4-90ae-8cbace16da84"},{"version":"CommandV1","origId":398795,"guid":"cf4d8e21-400c-4751-b9ad-06c53db2bceb","subtype":"command","commandType":"auto","position":27.0,"command":"%md \n## DataFrames\n\nLet's try the same thing with DataFrames.\n\nTo make a DataFrame, we'll need to convert our RDD into another RDD of a different type, something Spark can use to infer a _shema_. We'll use a case class.","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"e62ca492-ddd9-4d16-9ea9-c578992ed854"},{"version":"CommandV1","origId":398796,"guid":"25d705b6-968f-4fe9-a899-e7cceef20c0f","subtype":"command","commandType":"auto","position":28.0,"command":"class Parser extends Serializable { // This helps with scoping issues in the notebook\n  case class EditEntry(project: String, pageTitle: String, numberOfRequests: Long)\n\n  def parseLine(line: String) = {\n    line.split(\"\"\"\\s+\"\"\") match {\n      case Array(project, page, numRequests, _) =>\n        Some(EditEntry(project, page, numRequests.toLong))\n      case _ =>\n        None\n    }\n  }\n}\nval pagecountsDF = pagecountsRDD2.flatMap((new Parser).parseLine).toDF\n  \n","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":1.457062082038E12,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"bmc@ardentex.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"adcf0a49-f9f5-489d-89c9-19b54ca94cb2"},{"version":"CommandV1","origId":398797,"guid":"72796d06-2e7f-4643-a43d-ce216f0a5589","subtype":"command","commandType":"auto","position":29.0,"command":"%md Let's do what we did with the RDD, only with the DataFrame. This is an adaptation of what's on Slide 7.","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"5828f4f5-7112-4ce0-addb-ccfb669b2537"},{"version":"CommandV1","origId":398798,"guid":"9a40bf4f-40fb-433f-b805-efc60f1b4b33","subtype":"command","commandType":"auto","position":30.0,"command":"import org.apache.spark.sql.functions._\n\nval top100DF = pagecountsDF.filter($\"project\" === \"en\").\n                            filter(locate(\":\", $\"pageTitle\") === 0).\n                            filter(substring($\"pageTitle\", 0, 1) !== \".\").\n                            groupBy($\"pageTitle\").\n                            agg(sum($\"numberOfRequests\").as(\"count\")).\n                            orderBy($\"count\".desc)\ntop100DF.take(100).foreach { row =>\n  println(s\"${row(0)}: ${row(1)}\")\n}","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":1.457062088375E12,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"bmc@ardentex.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"377dd740-8653-443c-a359-d6cf29cf610d"},{"version":"CommandV1","origId":398799,"guid":"d63b74e3-af5e-4b39-8ede-174b9eb97b8f","subtype":"command","commandType":"auto","position":31.0,"command":"%md Easier to read, but... not type-safe. Yuck.","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"63e577d7-8b9e-4f7e-ab3b-c406646f7892"},{"version":"CommandV1","origId":398800,"guid":"8f0b58ea-d5a0-4606-9749-ceb2a6fd5fc5","subtype":"command","commandType":"auto","position":32.0,"command":"top100DF.take(1)","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":1.45706214883E12,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"bmc@ardentex.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"fb60edc3-1bef-4875-9686-e476c2d48dd4"},{"version":"CommandV1","origId":398801,"guid":"ad7cb267-4b7c-4297-9a0b-0b4e5be2f994","subtype":"command","commandType":"auto","position":33.0,"command":"%md If I want to get back to actual, useful Scala types, I have to do something like this:","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"9b6c1350-6447-4db2-ad84-bedffe4f4fac"},{"version":"CommandV1","origId":398802,"guid":"efdc13b5-db0e-4f76-864b-3bf3ab11b2c5","subtype":"command","commandType":"auto","position":34.0,"command":"top100DF.take(2).map { row =>\n  (row(0).asInstanceOf[String], row(1).asInstanceOf[Long])\n}","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":1.457062150975E12,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"bmc@ardentex.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"8f2c280f-69c8-4f76-a3ad-84bbb7e02a51"},{"version":"CommandV1","origId":398803,"guid":"a1b90efe-c641-42be-9d39-ee6b476ae216","subtype":"command","commandType":"auto","position":35.0,"command":"%md\n## Datasets\nDatasets can be created by using the SQL Context object's `read.text()` method:","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"0b550089-3c78-4844-af6c-88546cdaf7d6"},{"version":"CommandV1","origId":398804,"guid":"6b199d58-67ea-43c9-a034-1c12fc55e5d8","subtype":"command","commandType":"auto","position":36.0,"command":"// Notice that this returns a Dataset of Strings\nval pagecountsDS = sqlContext.read.text(\"dbfs:/mnt/wikipedia-readwrite/pagecounts/staging/\").as[String]","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":1.457062152268E12,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"bmc@ardentex.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"26473a1b-0ac2-4955-b60a-eae527a8d9be"},{"version":"CommandV1","origId":398805,"guid":"5b300dce-c1f0-4ee3-ab85-8abcca24a6a6","subtype":"command","commandType":"auto","position":37.0,"command":"%md Or, you can convert a DataFrame into a Dataset.","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"0efe5950-8bde-4d1d-8a67-3cfae42f5178"},{"version":"CommandV1","origId":398806,"guid":"0d784465-81be-45f8-bce6-105179f85110","subtype":"command","commandType":"auto","position":38.0,"command":"val pagecountsDS2 = pagecountsDF.as[(String, String, Long)]\npagecountsDS2.take(3).foreach(println)","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":1.457062154628E12,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"bmc@ardentex.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"480befe4-0ef0-4317-8006-5c0bb3802d53"},{"version":"CommandV1","origId":398807,"guid":"9e51d015-fc41-4d13-90b1-ecceaf1c8c8c","subtype":"command","commandType":"auto","position":39.0,"command":"%md Or:","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"ae52b0f7-d444-45aa-8fbc-b31fc9368f8e"},{"version":"CommandV1","origId":398808,"guid":"45100e9d-7aa7-43a3-bf78-e89d2c78cd89","subtype":"command","commandType":"auto","position":40.0,"command":"// Matching is done DataFrame column name -> case class field name\ncase class Edit(project: String, pageTitle: String, numberOfRequests: Long)\nval pagecountsDS3 = pagecountsDF.as[Edit]","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":1.457062155601E12,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"bmc@ardentex.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"bd37b696-5ed0-4aca-a3be-435c31b20400"},{"version":"CommandV1","origId":398809,"guid":"54323572-9ac1-403b-83c2-6e1470394b7a","subtype":"command","commandType":"auto","position":41.0,"command":"pagecountsDS3.count()","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":1.457062157444E12,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"bmc@ardentex.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"2ed56d6f-3bf5-46d6-bb92-c1304d694434"},{"version":"CommandV1","origId":398810,"guid":"f973a154-45f3-422a-a2df-846dcb3fca79","subtype":"command","commandType":"auto","position":42.0,"command":"pagecountsDS3.take(3).foreach(println)","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":1.457062158594E12,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"bmc@ardentex.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"de658eee-c44f-4ebb-9345-bf8f54be7509"},{"version":"CommandV1","origId":398811,"guid":"7ad31be9-e37a-43a9-bd36-636007e8f7ea","subtype":"command","commandType":"auto","position":43.0,"command":"%md You still have to get the types right on the conversions to Datasets, but once you have the Dataset, you have something that's type safe again. ","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"56d2a712-6d5c-4c50-aa70-884caec18471"},{"version":"CommandV1","origId":398812,"guid":"a8aa4d97-a7a2-46d2-9a4f-143b1e4c6630","subtype":"command","commandType":"auto","position":44.0,"command":"pagecountsDS3.filter(e => (e.project == \"en\") && (! e.pageTitle.contains(\":\")) && (! e.pageTitle.startsWith(\".\"))).\n              groupBy(_.pageTitle).  // GroupedDataset[String, DSEntry]\n              reduce { (e1, e2) =>\n                e1.copy(e1.project, e1.pageTitle, e1.numberOfRequests + e2.numberOfRequests)\n              }.\n              map(_._2).\n              toDF. // because there's currently no sortBy or orderBy on a Dataset\n              orderBy($\"numberOfRequests\".desc).\n              as[Edit].\n              take(100).\n              foreach { e =>\n                println(s\"${e.pageTitle}: ${e.numberOfRequests}\")\n              }\n              ","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":1.457062164537E12,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"bmc@ardentex.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"89b45571-1be0-453e-9694-33c5577e61af"},{"version":"CommandV1","origId":398813,"guid":"7e9db8d4-d051-4ae9-af9e-5014abc16fe7","subtype":"command","commandType":"auto","position":45.0,"command":"%md\n### Caching RDDs vs Datasets in memory\n\nThe `pagecountsRDD2` is already cached in memory. Let's cache the non-derived Dataset, as well, and compare them.","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"34e55547-4fa8-449d-bd24-8769b5c8dc31"},{"version":"CommandV1","origId":398814,"guid":"43d8bf9e-8ef0-4703-b1e8-c63aa4fa4645","subtype":"command","commandType":"auto","position":46.0,"command":"pagecountsDS.cache().count()","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":1.457062177843E12,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"bmc@ardentex.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"f0c1eb48-db75-4b9a-b3b4-5f7fc36b686a"},{"version":"CommandV1","origId":398815,"guid":"7f535aea-1d5b-4237-8f2f-59491fb75ed5","subtype":"command","commandType":"auto","position":47.0,"command":"%md And what happens if we cache a Dataset with Edit entries vs. an RDD with Edit entries?","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"31acf766-be2d-4246-af38-4c42f09f8dca"},{"version":"CommandV1","origId":398816,"guid":"e72d5c8d-4b9a-4310-82bd-18e6a6118ed6","subtype":"command","commandType":"auto","position":48.0,"command":"val pagecountsParsedRDD = pagecountsRDD.flatMap { line =>\n  line.split(\"\"\"\\s+\"\"\") match {\n    case Array(project, pageTitle, requests, _) => Some(Edit(project, pageTitle, requests.toLong))\n    case _ => None\n  }\n}\npagecountsParsedRDD.setName(\"pagecountsParsedRDD\").cache().count()","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":1.457062306402E12,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"bmc@ardentex.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"3272823a-de6b-4624-9587-08de460f0a36"},{"version":"CommandV1","origId":398821,"guid":"0695df75-0587-4309-a888-db46830b0da4","subtype":"command","commandType":"auto","position":48.5,"command":"pagecountsDS3.cache().count()","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":1.457062303176E12,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"bmc@ardentex.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"6b08c416-1523-4e0d-8ce0-3449aaee4205"},{"version":"CommandV1","origId":398817,"guid":"e62961bd-9af0-4896-b429-1133c2cace1d","subtype":"command","commandType":"auto","position":49.0,"command":"%md The Spark UI's Storage tab now shows all of these in memory. The Dataset is compressed in memory by default, so it takes up much less space.","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"6408af81-9ff0-4c78-b58c-b8c0f8cdb514"},{"version":"CommandV1","origId":398822,"guid":"36fdba39-4365-41b9-b4c4-d9c3d1a16430","subtype":"command","commandType":"auto","position":50.0,"command":"%md ## END OF DEMO","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"nuid":"7f005619-ada6-4f67-be8a-c18055944a98"}],"dashboards":[],"guid":"3cb9e6c1-106b-4a53-915c-19f5cc70efd4","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}};</script>
<script
 src="https://databricks-prod-cloudfront.cloud.databricks.com/static/201603010716030000-6118bb36ced9f46ebd6354723c21ab530ae8e014/js/notebook-main.js"
 onerror="window.mainJsLoadError = true;"></script>
</head>
<body>
  <script>
if (window.mainJsLoadError) {
  var u = 'https://databricks-prod-cloudfront.cloud.databricks.com/static/201603010716030000-6118bb36ced9f46ebd6354723c21ab530ae8e014/js/notebook-main.js';
  var b = document.getElementsByTagName('body')[0];
  var c = document.createElement('div');
  c.innerHTML = ('<h1>Network Error</h1>' +
    '<p><b>Please check your network connection and try again.</b></p>' +
    '<p>Could not load a required resource: ' + u + '</p>');
  c.style.margin = '30px';
  c.style.padding = '20px 50px';
  c.style.backgroundColor = '#f5f5f5';
  c.style.borderRadius = '5px';
  b.appendChild(c);
}
</script>
</body>
</html>
